# nMap

---

- [Overview](#overview)
- [Network Sweeping](#network-sweeping)
- [Stealth Scanning](#stealth-scanning)
- [TCP Connect Scanning](#tcp-connect-scanning)
- [UDP Scanning](#udp-scanning)
- [OS Fingerprinting](#os-fingerprinting)
- [Banner Grabbing / Service Enumeration](#service-enumeration)
- [Nmap Scripting Engine](#nmap-scripting-engine)

<a name="overview"></a>
## Overview

| Argument       | Description                                     |
| :-             | :-                                              |
| -p             | Port number(s) to scan                          |
| -oG            | “Greppable” output                              |
| -A             | OS Version, Script scanning, traceroute         |
| -O             | OS Version                                      |
| -sV            | Try find versions of software (banner grabbing) |
| --top-ports=20 | Scan top 20 common ports                        |
| -iL ips.txt    | Run against IP's in the text file               |

Scan the 1000 most popular TCP ports. (~70KB of traffic)
```sh
nmap __VICTIM_IP__
```

Scan all the TCP ports on the host. (~4.1MB of traffic)
```sh
nmap -p 1-65535 __VICTIM_IP__
```

<a name="network-sweeping"></a>
## Network Sweeping
Sends a TCP SYN packet to port 443, TCP ACK port 80, and ICMP timestamp request to each host.
```sh
nmap -sn 192.168.0.1-254 -oG ping-sweep.txt
```

Check all hosts that have port 80 open
```sh
nmap -p 80 192.168.0.1-254 -oG web-sweep.txt
```

Check all hosts for the top 20 ports using TCP Connect scanning, and detect OS version, script scanning and traceroute with -A.
```sh
nmap -sT -A --top-ports=20 192.168.0.1-254 -oG top-port-sweep.txt
```

<a name="stealth-scanning"></a>
## Stealth Scanning
Doesn't show in application logs because the handshake is never completed, it doesnt get passed to the application layer. It is also faster and more efficient as it doesn't do the full handshake requiring more packets. Old firewalls did not used to catch this type of scan however modern firewalls do.
Stealth Scanning (SYN Packet only, doesnt complete TCP handshake). (Default when no scan options and root).
```sh
sudo nmap -sS __VICTIM_IP__
```

<a name="tcp-connect-scanning"></a>
## TCP Connect Scanning
If nmap doesn't run as sudo so doesnt have raw socket priviledges, it will use TCP connect scan. (Full TCP handshake.) Slower than a SYN scan (stealth).
```sh
nmap -sT __VICTIM_IP__
```

<a name="udp-scanning"></a>
## UDP Scanning
Uses combination of 2 methods, most ports ICMP unreachable. Common ports such as 161 (SNMP), sends protocol specific packet to try get application response.
```sh
sudo nmap -sU __VICTIM_IP__
```

<a name="os-fingerprinting"></a>
## OS Fingerprinting
Best guess based on port responses and services.
```sh
sudo nmap -O __VICTIM_IP__
```

<a name="service-enumeration"></a>
## Banner Grabbing / Service Enumeration
The -sV probes open ports for service and version information.
Version message can be changed by system administrators to deter or mislead attackers.
```sh
nmap -sV -sT -A __VICTIM_IP__
```

<a name="nmap-scripting-engine"></a>
## Nmap Scripting Engine
Located in `/usr/share/nmap/scripts`.

Search safe scripts against the port
```sh
nmap -p 445 --script "vuln and safe" __VICTIM_IP__
```

Run the SMB OS Discovery script
```sh
nmap __VICTIM_IP__ --script=smb-os-discovery
```

DNS Zone Transfer Script
```sh
nmap --script=dns-zone-transfer -p 53 ns2.megacorpone.com
```

View script help
```sh
nmap --script-help dns-zone-transfer
```
