# Monitoring

---

- [File Monitoring](#file-monitoring)
- [Network Monitoring](#network-monitoring)

<a name="file-monitoring"></a>
## File Monitoring

### Tail
Keep displaying the output of the file as it keeps getting appended.
```sh
tail -f /var/log/apache2/access.log
```

Display the last 100 lines of the log file.
```sh
tail -n100
```

### Watch
Run the “w” program every 5 seconds. “w” displays logged in users.
```sh
watch -n 5 w
```

<a name="network-monitoring"></a>
## Network Monitoring

### TCP Dump
| Argument       | Description                   |
| :-             | :-                            |
| -n             | Skip DNS lookup               |
| -r             | Read from packet capture file |
| -A             | Print in ASCII                |

Listen to traffic on tun0 interface.
```sh
sudo tcpdump -i tun0
```

Read the pcap dump file to stdout.
```sh
sudo tcpdump -r dump.pcap 
```

Display the top 10 ip address / ports in the packet file.
```sh
sudo tcpdump -n -r dump.pcap | awk -F" " ‘{print $3}’ | sort | uniq -c | head
```

Filter the source host to __VICTIM_IP__.
```sh
sudo tcpdump -n src host __VICTIM_IP__ -r dump.pcap
```

Filter the destination host to __VICTIM_IP__.
```sh
sudo tcpdump -n dst host __VICTIM_IP__ -r dump.pcap
```

Filter the traffic to port __VICTIM_PORT__.
```sh
sudo tcpdump -n port __VICTIM_PORT__ -r dump.pcap
```

Dump the data with hex and text using X, piping to less.
```sh
sudo tcpdump -nX -r dump.pcap | less
```

**Advanced Filtering**

CWR, ECE, URG, ACK, PSH, RST, SYN, FIN are in a single 4 byte as flags.
To just get ACK and PSH bitmask;
```sh
echo “$((2#00011000))”
```
Returns 24

Dump in ascii format, where byte 13 (flags) is 24. Note array is 0 indexed.
```sh
sudo tcpdump -A -n ‘tcp[13] = 24’ -r dump.pcap
```
