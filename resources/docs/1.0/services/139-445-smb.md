# 139 / 445 - SMB

---

- [nMap Scripts](#nmap-scripts)
- [SMB Client](#smb-client)
- [Mounting](#mounting)
- [Enum 4 Linux](#enum4linux)
- [NBT Scan](#nbtscan)
- [Eternal](#eternal)
- [Public Exploits](#public-exploits)

> {info} **SMB** stands for **Server Message Block**

<a name="nmap-scripts"></a>
## nMap Scripts
```sh
nmap --script "safe or smb-enum-*" -p 445 __VICTIM_IP__
```

<a name="smb-client"></a>
## SMB Client
List smb shares
```sh
smbclient -L __VICTIM_IP__
```

List folders within share
```sh
smbclient //__VICTIM_IP__/Users
```

<a name="mounting"></a>
## Mounting
Mount `Users` share anonymously to `/mnt/share`.
```sh
sudo mount -t cifs //__VICTIM_IP__/share /mnt/share
```

Mount share as user.
```sh
sudo mount -t cifs -o username=john,password=password123 //__VICTIM_IP__/Users /mnt/share
```

<a name="enum4linux"></a>
## Enum 4 Linux
Enumerate information from SMB
```sh
enum4linux __VICTIM_IP__
```

<a name="nbtscan"></a>
## NBT Scan
| Argument       | Description                                           |
| :-             | :-                                                    |
| -r             | Queries NetBIOS name service for valid NetBIOS names. |
```sh
sudo nbtscan -r 192.168.0.1/24
```

<a name="eternal"></a>
## Eternal
This covers **Eternal Blue**, **Eternal Romance** and **Eternal Synergy**.

- exploit/windows/smb/ms17_010_eternalblue (Windows 7 and Server 2008 R2 (x64) All Service Packs)
- https://github.com/phi10s/MS17-010
    - Code may need to be modified for a reverse shell or to create an admin user.
    - For Windows XP, see zzz_exploit.py and function smb_pwn.
    - May need to disable firewall before spawning shell.

Some of these exploits require a named pipe.
- auxiliary/scanner/smb/pipe_auditor

<a name="public-exploits"></a>
## Public Exploits
Search for public exploits against the SMB platform and version.
- [Samba < 2.2.8](https://www.exploit-db.com/exploits/10)
- auxiliary/admin/smb/samba_symlink_traversal
