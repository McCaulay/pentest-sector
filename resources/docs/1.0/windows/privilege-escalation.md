# Privilege Escalation

---

- [JuicyPotato](#juicy-potato)
- [Insecure File Permissions](#insecure-file-permissions)
- [Leveraging Unquoted Service Paths](#leveraging-unquoted-service-paths)
- [USBPcap](#usbpcap)
- [PowerShell Empire](#powershell-empire)

<a name="juicy-potato"></a>
## JuicyPotato
JuicyPotato required `SeImpersonatePrivilege` or `SeAssignPrimaryToken` to be enabled and the OS is not patched.
```sh
whoami /priv
```

This application requires any unused local port (5837), the application to run (shell.exe) and a valid CLSID. You may need to try run this for many different CLSID's on the operating system you are on.
```sh
JuicyPotatox86.exe -t t -p shell.exe -l 5837 -c {6d18ad12-bde3-4393-b311-099c346e6df9}
```

- Source: https://github.com/ohpe/juicy-potato
- CLSIDs: https://github.com/ohpe/juicy-potato/tree/master/CLSID

<a name="insecure-file-permissions"></a>
## Insecure File Permissions
Check file permission access
```sh
icacls "C:\Program Files\Serviio\bin\ServiioService.exe"
```

If a service has incorrect file permissions, we may be able to replace the executable with a malicious executable to create a reverse shell or add a user to the system. Then restarting the service, or if it autostarts on boot, rebooting the machine will execute that service.

<a name="leveraging-unquoted-service-paths"></a>
## Leveraging Unquoted Service Paths
Get list of running services.
```powershell
Get-WmiObject win32_service | Select-Object Name, State, PathName | Where-Object {$_.State -like 'Running'}
```

If a service path is unquoted and contains a space (eg Program Files), it can treat values after spaces as arguments.

Eg: `C:\Program Files\My Program\My Service\service.exe` will attempt the followin paths:
- `C:\Program.exe`
- `C:\Program Files\My.exe`
- `C:\Program Files\My Program\My.exe`
- `C:\Program Files\My Program\My service\service.exe`

If we can write an executable in any of these places it will run when the service is restarted instead of the actual executable file.

<a name="usbpcap"></a>
## USBPcap
Driver exploit, ensure OS / Version and Architecture are correct as these can cause Blue Screen Of Death. Dangerous!

<a name="powershell-empire"></a>
## PowerShell Empire
Uses serveral techniques such as misconfigurations, unquoted service paths, improper permissions on service executeables and more.
```sh
usemodule powershell/privesc/powerup/allchecks
```
